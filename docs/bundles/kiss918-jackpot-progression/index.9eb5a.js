window.__require=function e(t,a,o){function n(r,s){if(!a[r]){if(!t[r]){var c=r.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var p=a[r]={exports:{}};t[r][0].call(p.exports,function(e){return n(t[r][1][e]||e)},p,p.exports,e,t,a,o)}return a[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<o.length;r++)n(o[r]);return n}({Kiss918AngpaoPrefab:[function(e,t,a){"use strict";cc._RF.push(t,"2ae71rZxs5Nf7IhKPKTBRlL","Kiss918AngpaoPrefab");var o=this&&this.__decorate||function(e,t,a,o){var n,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,a,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(r=(i<3?n(r):i>3?n(t,a,r):n(t,a))||r);return i>3&&r&&Object.defineProperty(t,a,r),r},n=this&&this.__awaiter||function(e,t,a,o){return new(a||(a=Promise))(function(n,i){function r(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,s)}c((o=o.apply(e,t||[])).next())})},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});const r=e("../../../../../main-bundle/scripts/configs/PanelConfigs"),s=e("../../../../../scripts/framework/gg"),c=e("../../../../../scripts/GlobalData"),l=e("../../../../../scripts/HelperTools"),p=i(e("../../../../../scripts/manager/AudioManager")),u=i(e("../../../../../scripts/manager/BankManager")),d=e("../../../../../scripts/manager/CreditCoinConvertorManager"),g=i(e("../../../../../scripts/manager/GameSystemManager")),h=e("./Kiss918JackpotEnum"),m=i(e("./Kiss918JackpotProgressionModule")),{ccclass:k,property:f}=cc._decorator;let J=class extends cc.Component{constructor(){super(...arguments),this.angpaoBGM=null,this.angpaoOpen=null,this.angpaoReceive=null,this.isAngpaoTriggered=!1,this.isClaming=!1,this.haveJackpotBundle=!1,this.isTesting=!1,this.claimJackpot=null}onLoad(){this.registerEvent()}start(){return n(this,void 0,void 0,function*(){this.addBgm(),yield this.loadAssets()})}triggerAngpao(){return n(this,void 0,void 0,function*(){if(this.isAngpaoTriggered)return;c.GlobalData.flags.jackpotWinShowing=!0,this.isAngpaoTriggered=!0;const e=this.node.getChildByName("Angpao"),t=this.node.getChildByName("BGPanel"),a=this.node.getChildByName("AngpaoLight");e.active=!0,t.active=!0,a.active=!0,this.callClaimAngpao(),this.node.getComponent(cc.Animation).play("Angpao-animation"),this.node.getComponent(cc.Animation).once(cc.Animation.EventType.FINISHED,()=>n(this,void 0,void 0,function*(){this.node.getComponent(cc.Animation).play("Angpao-Loop-animation"),this.node.getChildByName("Angpao").getComponent(cc.Button).enabled=!0})),s.gg.eventManager.emit("AngpaoPrefab.OnStopAllSfx"),p.default.getInstance().stopAll(),p.default.getInstance().play("WZxifen",!0)})}callClaimAngpao(){return n(this,void 0,void 0,function*(){this.claimJackpot=yield m.default.claimJackpot()})}clickAngpao(){return n(this,void 0,void 0,function*(){if(this.isClaming)return;this.isClaming=!0,this.node.getComponent(cc.Animation).stop();const e=this.node.getChildByName("Angpao"),t=this.node.getChildByName("AngpaoLight"),a=this.node.getChildByName("AngpaoOpen"),o=a.getChildByName("WinAmount").getComponent(cc.Label);if(e.active=!1,t.active=!1,t.getComponent(cc.Sprite).spriteFrame=null,a.active=!0,this.isTesting){const e=10;o.string=d.CCConvertor(e.toFixed(2)),u.default.getInstance().updateNewBalance(e,u.default.getInstance().accountInfo.balance+e),s.gg.eventManager.emit("HUDPrefab.ManuallyUpdateBalanceOnce"),yield l.Delay(2)}else{o.string=d.CCConvertor(m.default.jackpotPendingClaimData.JackpotInfo.CurrencyAmount.toFixed(2)),yield l.NoOperationUntil(()=>{var e;return null===(e=this.claimJackpot)||void 0===e||!e.CurrencyBalance});const e=this.claimJackpot;this.claimJackpot.CurrencyBalance?(u.default.getInstance().updateNewBalance(m.default.jackpotPendingClaimData.JackpotInfo.CurrencyAmount,e.CurrencyBalance),m.default.jackpotPendingClaimData=null,s.gg.eventManager.emit("HUDPrefab.ManuallyUpdateBalanceOnce"),yield l.Delay(2)):s.gg.panelRouter.show({panel:r.PanelConfigs.errorToastPanel,data:{stopRedirectToLogin:!0,message:"Something wrong happened",errorCode:""}})}this.closedAngpao(),c.GlobalData.flags.jackpotWinShowing=!1,this.isAngpaoTriggered=!1,this.isClaming=!1,this.isTesting=!1})}closedAngpao(){p.default.getInstance().stop("WZxifen");const e=this.node.getChildByName("AngpaoOpen");e.getComponent(cc.Button).interactable=!1,e.active=!1,this.node.getChildByName("BGPanel").active=!1,s.gg.eventManager.emit("AngpaoPrefab.OnResumeSfx")}registerCheckPlayerJackpotStatus(){this.schedule(this.checkPlayerJackpotStatus,5)}checkPlayerJackpotStatus(){return n(this,void 0,void 0,function*(){this.isAngpaoTriggered||m.default.jackpotPendingClaimData||this.haveJackpotBundle||m.default.getCurrentJackpotInfo()})}onGameRoundEnded(e){(null==e?void 0:e.gameMode)!=h.Kiss918GameModeType.NormalGame||c.GlobalData.flags.jackpotWinShowing||this.isClaming||m.default.haveAngpao()&&this.triggerAngpao()}onRandomJackpotAmount(){this.haveJackpotBundle=!0}onAngpaoTriggerTesting(e){(null==e?void 0:e.gameMode)==h.Kiss918GameModeType.NormalGame?c.GlobalData.flags.jackpotWinShowing?console.log("Angpao trigger testing - jackpotWinShowing"):this.isClaming?console.log("Angpao trigger testing - claiming Angpao"):(this.isTesting=!0,this.triggerAngpao()):console.log("Angpao trigger testing error: gameMode is not Normal Game (value:"+(null==e?void 0:e.gameMode)+")")}addBgm(){p.default.getInstance().add(this.angpaoBGM.name,this.angpaoBGM)}registerEvent(){s.gg.eventManager.on("GamePanelFrefab.OnGameRoundEnded",this.onGameRoundEnded,this),s.gg.eventManager.on("JackporPanelEvent.OnRandomJackpotUpdate",this.onRandomJackpotAmount,this),s.gg.eventManager.on("AngpaoPrefab.OnAngpaoTriggerTesting",this.onAngpaoTriggerTesting,this)}loadAssets(){return n(this,void 0,void 0,function*(){return new Promise(e=>{cc.assetManager.loadBundle("jackpot-progression",(t,a)=>{if(t)return console.error(t);const o=`textures/${g.default.getInstance().getLanguageCode()}`,i=l.AsyncTask(e=>n(this,void 0,void 0,function*(){a.load(`${o}/lobby-red`,cc.SpriteAtlas,(t,a)=>{this.angpaoOpen.spriteFrame=a.getSpriteFrame("RedBG2"),this.angpaoReceive.spriteFrame=a.getSpriteFrame("RedRecieve"),e()})}));Promise.all([i]).then(()=>{e()})})})})}};o([f(cc.AudioClip)],J.prototype,"angpaoBGM",void 0),o([f(cc.Sprite)],J.prototype,"angpaoOpen",void 0),o([f(cc.Sprite)],J.prototype,"angpaoReceive",void 0),J=o([k],J),a.default=J,cc._RF.pop()},{"../../../../../main-bundle/scripts/configs/PanelConfigs":void 0,"../../../../../scripts/GlobalData":void 0,"../../../../../scripts/HelperTools":void 0,"../../../../../scripts/framework/gg":void 0,"../../../../../scripts/manager/AudioManager":void 0,"../../../../../scripts/manager/BankManager":void 0,"../../../../../scripts/manager/CreditCoinConvertorManager":void 0,"../../../../../scripts/manager/GameSystemManager":void 0,"./Kiss918JackpotEnum":"Kiss918JackpotEnum","./Kiss918JackpotProgressionModule":"Kiss918JackpotProgressionModule"}],Kiss918JackpotEnum:[function(e,t,a){"use strict";cc._RF.push(t,"0758bjGE8NJi5vi07kT2aZW","Kiss918JackpotEnum"),Object.defineProperty(a,"__esModule",{value:!0}),a.Kiss918GameModeType=a.Kiss918JackpotType=void 0,function(e){e[e.None=0]="None",e[e.Mini=1]="Mini",e[e.Minor=2]="Minor",e[e.Major=3]="Major",e[e.Grand=4]="Grand",e[e.Custom=5]="Custom",e[e.Angpau=6]="Angpau",e[e.Random=99]="Random"}(a.Kiss918JackpotType||(a.Kiss918JackpotType={})),function(e){e[e.Undefined=-1]="Undefined",e[e.NormalGame=0]="NormalGame",e[e.ReSpin=1]="ReSpin",e[e.FreeGame=2]="FreeGame",e[e.Jackpot=3]="Jackpot",e[e.BonusGame=4]="BonusGame",e[e.PreFreeGame=5]="PreFreeGame"}(a.Kiss918GameModeType||(a.Kiss918GameModeType={})),cc._RF.pop()},{}],Kiss918JackpotProgressionModule:[function(e,t,a){"use strict";cc._RF.push(t,"805f6yZYmxI5aRiYiEefeJh","Kiss918JackpotProgressionModule");var o=this&&this.__awaiter||function(e,t,a,o){return new(a||(a=Promise))(function(n,i){function r(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,s)}c((o=o.apply(e,t||[])).next())})},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});const i=e("../../../../../scripts/GlobalData"),r=e("../../../../../scripts/HelperTools"),s=n(e("../server/Kiss918JackpotServer")),c=e("./Kiss918JackpotEnum");class l extends cc.Component{static getStartingJackpotAmount(e){let t=0;switch(e){case c.Kiss918JackpotType.Major:t=this.major;break;case c.Kiss918JackpotType.Random:t=this.random;break;case c.Kiss918JackpotType.Minor:t=this.minor}return t}static generateJackpotAmount(){const e=i.GlobalData.data.transact.Bet,t=r.GetRandomFloat(e*this.minJackpotMultiplier,e*this.maxJackpotMultiplier),a=r.GetRandomFloat(e*this.minJackpotMultiplier,e*this.maxJackpotMultiplier),o=r.GetRandomFloat(e*this.minJackpotMultiplier,e*this.maxJackpotMultiplier);this.major=t<=o?o*r.GetRandomFloat(1.1,1.5):t,this.random=a,this.minor=o}static getJackpotAmount(e){let t=0;switch(e){case c.Kiss918JackpotType.Major:t=this.major;break;case c.Kiss918JackpotType.Random:t=this.random;break;case c.Kiss918JackpotType.Minor:t=this.minor}return t}static callJackpotLoginAPI(){return o(this,void 0,void 0,function*(){yield s.default.getInstance().getJackpotLoginToken();const e=yield s.default.getInstance().doJackpotLogin();this.processAndStoreJackpotWonData(e.data)})}static getCurrentJackpotInfo(){return o(this,void 0,void 0,function*(){const e=yield s.default.getInstance().getCurrentJackpotInfo();return this.processAndStoreJackpotWonData(e.data)})}static claimJackpot(){return o(this,void 0,void 0,function*(){return(yield s.default.getInstance().claimJackpot()).data})}static updateJackpotBalancePool(){return o(this,void 0,void 0,function*(){this.generateJackpotAmount()})}static processAndStoreJackpotWonData(e){if(null==e?void 0:e.JackpotInfo){switch(e.JackpotInfo.JackpotType){case c.Kiss918JackpotType.Major:e.JackpotInfo.JackpotType=c.Kiss918JackpotType.Major;break;case c.Kiss918JackpotType.Minor:e.JackpotInfo.JackpotType=c.Kiss918JackpotType.Minor;break;case c.Kiss918JackpotType.Angpau:e.JackpotInfo.JackpotType=c.Kiss918JackpotType.Angpau;break;default:e.JackpotInfo.JackpotType=c.Kiss918JackpotType.Random}this.jackpotPendingClaimData=e}return e}static haveAngpao(){var e;return(null===(e=this.jackpotPendingClaimData)||void 0===e?void 0:e.JackpotInfo.JackpotType)===c.Kiss918JackpotType.Angpau}}a.default=l,l.pool={minor:0,random:0,major:0},l.random=0,l.major=0,l.minor=0,l.fakeData=!0,l.jackpotPendingClaimData=null,l.minJackpotMultiplier=5,l.maxJackpotMultiplier=1e3,cc._RF.pop()},{"../../../../../scripts/GlobalData":void 0,"../../../../../scripts/HelperTools":void 0,"../server/Kiss918JackpotServer":"Kiss918JackpotServer","./Kiss918JackpotEnum":"Kiss918JackpotEnum"}],Kiss918JackpotProgressionPrefab:[function(e,t,a){"use strict";cc._RF.push(t,"f5fc5UGkGlOwJZYtqHz5Y8v","Kiss918JackpotProgressionPrefab");var o=this&&this.__createBinding||(Object.create?function(e,t,a,o){void 0===o&&(o=a),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,o){void 0===o&&(o=a),e[o]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__decorate||function(e,t,a,o){var n,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,a,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(r=(i<3?n(r):i>3?n(t,a,r):n(t,a))||r);return i>3&&r&&Object.defineProperty(t,a,r),r},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&o(t,e,a);return n(t,e),t},s=this&&this.__awaiter||function(e,t,a,o){return new(a||(a=Promise))(function(n,i){function r(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,s)}c((o=o.apply(e,t||[])).next())})},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});const l=e("../../../../../scripts/framework/gg"),p=e("../../../../../scripts/framework/lib/router/PanelComponent"),u=e("../../../../../scripts/GlobalData"),d=e("../../../../../scripts/HelperTools"),g=c(e("../../../../../scripts/manager/AudioManager")),h=c(e("../../../../../scripts/manager/BankManager")),m=r(e("../../../../../scripts/manager/CreditCoinConvertorManager")),k=c(e("../../../../../scripts/manager/GameSystemManager")),f=c(e("../jackpot-running-number-label/Kiss918JackpotRunningNumberLabel")),J=e("./Kiss918JackpotEnum"),v=c(e("./Kiss918JackpotProgressionModule")),{ccclass:C,property:y}=cc._decorator;let b=class extends p.PanelComponent{constructor(){super(...arguments),this.jackpotBg=null,this.jackpotCounter=null,this.labelMajor=null,this.labelRandom=null,this.labelMinor=null,this.labelBalance=null,this.wonAmountObj={},this.originalBalanceAmount=0,this.originalWonAmount=0,this.originalJackpotWonAmount=0,this.triggerJackpotWin=!1,this.triggerType=null,this.claimingJackpot=!1,this.isDiableJackpot=!1}onLoad(){this.labelMajor.string="0",this.labelRandom.string="0",this.labelMinor.string="0",this.registerEvent(),this.registerCallback(),this.addLabelForCreditCoinUpdate()}start(){return s(this,void 0,void 0,function*(){const e=v.default.callJackpotLoginAPI(),t=this.loadJackpotAssets();yield Promise.all([e,t]),this.setupJackpotModule()})}show(e){e.onShowed()}hide(e){e.onHided()}onDisableJackpot(){this.isDiableJackpot=!0,this.unschedule(this.updateMajorJackpot),this.unschedule(this.updateMinorJackpot),this.unschedule(this.updateRandomJackpot),this.unschedule(this.generateJackpotAmount),this.node.opacity=0}registerEvent(){l.gg.eventManager.on("JackporPanelEvent.UpdateJackpotProgression",this.onCountingBalance,this),l.gg.eventManager.on("JackporPanelEvent.ResetJackpotProgression",this.resetJackpotWonCounter,this),l.gg.eventManager.on("JackporPanelEvent.GetLabelBalance",this.getLabelBalance,this),l.gg.eventManager.on("JackporPanelEvent.UpdateAllJackpotBalance",this.updateAllJackpotBalance,this),l.gg.eventManager.on("JackporPanelEvent.OnDisableJackpot",this.onDisableJackpot,this),l.gg.eventManager.on("GamePanelFrefab.OnGameRoundEnded",this.onGameRoundEnded,this),l.gg.eventManager.on("JackpotPanelPrefab.onJackpotTriggerTesting",this.onJackpotTriggerTesting,this)}getLabelBalance(e){this.labelBalance||(this.labelBalance=e)}registerCallback(){this.labelMinor.node.getComponent(f.default).registerOnCompleteRunningEventCallback(()=>{v.default.fakeData||this.triggerJackpotWin||this.updateMinorJackpot()}),this.labelMajor.node.getComponent(f.default).registerOnCompleteRunningEventCallback(()=>{v.default.fakeData||this.triggerJackpotWin||this.updateMajorJackpot()})}setupJackpotModule(){return s(this,void 0,void 0,function*(){this.registerUpdateJackpotBalance(),this.isDiableJackpot||(v.default.updateJackpotBalancePool(),this.updateStartingJackpot(),v.default.fakeData&&(this.registerMinorJackpotSchedule(),this.registerMajorJackpotSchedule(),this.registerRandomJackpotSchedule()),this.registerGenerateJackpotAmount(),this.jackpotCounter.active=!0)})}updateStartingJackpot(){this.generateJackpotAmount(),this.updateRandomJackpot(),this.updateMinorJackpot(),this.updateMajorJackpot()}updateJackpotBalance(e){return s(this,void 0,void 0,function*(){v.default.updateJackpotBalancePool(),this.updateAfterJackpot(e),e==J.Kiss918JackpotType.Minor?this.updateMinorJackpot():e==J.Kiss918JackpotType.Major?this.updateMajorJackpot():e==J.Kiss918JackpotType.Random&&(this.updateRandomJackpot(),this.registerRandomJackpotSchedule())})}updateAllJackpotBalance(){return s(this,void 0,void 0,function*(){this.unschedule(this.updateMajorJackpot),this.unschedule(this.updateMinorJackpot),this.unschedule(this.updateRandomJackpot),this.generateJackpotAmount(),this.updateRandomJackpot(),this.updateMinorJackpot(),this.updateMajorJackpot(),this.registerMajorJackpotSchedule(),this.registerRandomJackpotSchedule(),this.registerMinorJackpotSchedule()})}updateAfterJackpot(e){if(e==J.Kiss918JackpotType.Minor){const e=v.default.getStartingJackpotAmount(J.Kiss918JackpotType.Minor);this.labelMinor.string=m.CCConvertor(e.toFixed(2))}else if(e==J.Kiss918JackpotType.Major){const e=v.default.getStartingJackpotAmount(J.Kiss918JackpotType.Major);this.labelMajor.string=m.CCConvertor(e.toFixed(2))}else if(e==J.Kiss918JackpotType.Random){const e=v.default.getStartingJackpotAmount(J.Kiss918JackpotType.Random);this.labelRandom.string=m.CCConvertor(e.toFixed(2))}}updateRandomJackpot(){const e=v.default.getJackpotAmount(J.Kiss918JackpotType.Random);this.labelRandom.string=m.CCConvertor(e.toFixed(2)),l.gg.eventManager.emit("JackporPanelEvent.OnRandomJackpotUpdate",e.toFixed(2))}updateMinorJackpot(){const e=v.default.getJackpotAmount(J.Kiss918JackpotType.Minor);this.labelMinor.string=m.CCConvertor(e.toFixed(2)),l.gg.eventManager.emit("JackporPanelEvent.OnMinorJackpotUpdate",e.toFixed(2))}updateMajorJackpot(){const e=v.default.getJackpotAmount(J.Kiss918JackpotType.Major);this.labelMajor.string=m.CCConvertor(e.toFixed(2)),l.gg.eventManager.emit("JackporPanelEvent.OnMajorJackpotUpdate",e.toFixed(2))}generateJackpotAmount(){v.default.generateJackpotAmount()}checkPlayerJackpotStatus(){return s(this,void 0,void 0,function*(){this.claimingJackpot||u.GlobalData.flags.jackpotWinShowing||v.default.jackpotPendingClaimData||v.default.getCurrentJackpotInfo()})}onGameRoundEnded(e){return s(this,void 0,void 0,function*(){if((null==e?void 0:e.gameMode)!=J.Kiss918GameModeType.NormalGame||u.GlobalData.flags.jackpotWinShowing||this.claimingJackpot)return;const t=v.default.jackpotPendingClaimData;if(t&&t.JackpotInfo.JackpotType!=J.Kiss918JackpotType.Angpau){this.claimingJackpot=!0;const e=yield v.default.claimJackpot();if(this.claimingJackpot=!1,e.CurrencyBalance){h.default.getInstance().updateNewBalance(t.JackpotInfo.CurrencyAmount,e.CurrencyBalance);const a=m.CCConvertor((h.default.getInstance().accountInfo.balance-t.JackpotInfo.CurrencyAmount).toFixed(2));this.originalBalanceAmount=Number(a);const o={jackpotType:t.JackpotInfo.JackpotType,amount:t.JackpotInfo.CurrencyAmount};this.originalJackpotWonAmount=t.JackpotInfo.CurrencyAmount,l.gg.eventManager.emit("JackporPanelEvent.OnJackpotWon",o),v.default.jackpotPendingClaimData=null}}})}syncOriginalBalanceAmountToLatest(){const e=this.originalJackpotWonAmount,t=m.CCConvertor((h.default.getInstance().accountInfo.balance-e).toFixed(2));this.originalBalanceAmount=Number(t)}onJackpotTriggerTesting(e){if((null==e?void 0:e.gameMode)!=J.Kiss918GameModeType.NormalGame)return void console.log("jackpot trigger testing error: gameMode is not Normal Game (value:"+(null==e?void 0:e.gameMode)+")");if(u.GlobalData.flags.jackpotWinShowing)return void console.log("jackpot trigger testing - jackpotWinShowing");if(this.claimingJackpot)return void console.log("jackpot trigger testing - claimingJackpot");v.default.jackpotPendingClaimData={JackpotInfo:{GameSessionId:123,JackpotType:2,CurrencyAmount:10,Amount:1e3},Status:200,Ts:1540981472};const t=v.default.jackpotPendingClaimData,a=h.default.getInstance().accountInfo.balance,o={CoinsBalance:m.CCConvertor(a.toFixed(2))+t.JackpotInfo.Amount,CurrencyBalance:a+t.JackpotInfo.CurrencyAmount,Status:200,Ts:1692110606};if(o.CurrencyBalance){h.default.getInstance().updateNewBalance(t.JackpotInfo.CurrencyAmount,o.CurrencyBalance);const e=m.CCConvertor((h.default.getInstance().accountInfo.balance-t.JackpotInfo.CurrencyAmount).toFixed(2));this.originalBalanceAmount=Number(e);const a={jackpotType:t.JackpotInfo.JackpotType,amount:t.JackpotInfo.CurrencyAmount};this.originalJackpotWonAmount=t.JackpotInfo.CurrencyAmount,l.gg.eventManager.emit("JackporPanelEvent.OnJackpotWon",a),v.default.jackpotPendingClaimData=null}}registerGenerateJackpotAmount(){this.schedule(this.generateJackpotAmount,1,1/0,0)}registerMajorJackpotSchedule(){this.schedule(this.updateMajorJackpot,3,1/0,0)}registerRandomJackpotSchedule(){this.schedule(this.updateRandomJackpot,3,1/0,0)}registerMinorJackpotSchedule(){this.schedule(this.updateMinorJackpot,3,1/0,0)}registerUpdateJackpotBalance(){this.schedule(this.checkPlayerJackpotStatus,5)}addLabelForCreditCoinUpdate(){m.default.getInstance().addLabelSprite(this.labelMajor),m.default.getInstance().addLabelSprite(this.labelMinor),m.default.getInstance().addLabelSprite(this.labelRandom)}onCountingBalance(e){return s(this,void 0,void 0,function*(){switch(this.triggerJackpotWin=!0,this.triggerType=e.type,this.wonAmountObj={amount:Number(e.jackpotWonAmount)},this.originalWonAmount=Number(e.jackpotWonAmount),this.triggerType){case J.Kiss918JackpotType.Major:this.unschedule(this.updateMajorJackpot),this.labelMajor.node.getComponent(f.default).immediatelyToFinalValue(),this.labelMajor.node.color=cc.Color.RED,this.labelMajor.string=e.jackpotWonAmount,this.jackpotWonAmountReducer(this.labelMajor,this.wonAmountObj,e.maxJackpotAnimTime);break;case J.Kiss918JackpotType.Random:this.unschedule(this.updateRandomJackpot),this.labelRandom.node.getComponent(f.default).immediatelyToFinalValue(),this.labelRandom.node.color=cc.Color.RED,this.labelRandom.string=e.jackpotWonAmount,this.jackpotWonAmountReducer(this.labelRandom,this.wonAmountObj,e.maxJackpotAnimTime);break;case J.Kiss918JackpotType.Minor:this.unschedule(this.updateMinorJackpot),this.labelMinor.node.getComponent(f.default).immediatelyToFinalValue(),this.labelMinor.node.color=cc.Color.RED,this.labelMinor.string=e.jackpotWonAmount,this.jackpotWonAmountReducer(this.labelMinor,this.wonAmountObj,e.maxJackpotAnimTime),this.labelMinor.node.color=cc.Color.RED}})}jackpotWonAmountReducer(e,t,a){let o=0;const n=t.amount<10?2:a,i=m.default.getInstance().getConvertionType()===m.CCConvertionType.Coin?0:2;m.default.getInstance().enable=!1,g.default.getInstance().play("Sfx_CoinLoop",!0);const r=t.amount;cc.tween(t).to(n,{amount:0},{progress:(t,a,n,s)=>(this.syncOriginalBalanceAmountToLatest(),o=cc.misc.lerp(t,a,s),e.string=o.toFixed(i),this.labelBalance.string=(this.originalBalanceAmount+(r-o)).toFixed(i),o)}).call(()=>{e.string="0",m.default.getInstance().enable=!0,g.default.getInstance().stop("Sfx_CoinLoop")}).start()}resetJackpotWonCounter(e){return s(this,void 0,void 0,function*(){cc.Tween.stopAllByTarget(this.wonAmountObj);const t=m.default.getInstance().getConvertionType()===m.CCConvertionType.Coin?0:2;switch(this.labelBalance.string=(this.originalBalanceAmount+this.originalWonAmount).toFixed(t),this.triggerJackpotWin=!1,this.triggerType=null,m.default.getInstance().enable=!0,e){case J.Kiss918JackpotType.Major:this.labelMajor.node.color=cc.Color.WHITE,this.labelMajor.string="0",yield d.Delay(1),this.updateJackpotBalance(J.Kiss918JackpotType.Major);break;case J.Kiss918JackpotType.Random:this.labelRandom.node.color=cc.Color.WHITE,this.labelRandom.string="0",yield d.Delay(1),this.updateJackpotBalance(J.Kiss918JackpotType.Random);break;case J.Kiss918JackpotType.Minor:this.labelMinor.node.color=cc.Color.WHITE,this.labelMinor.string="0",yield d.Delay(1),this.updateJackpotBalance(J.Kiss918JackpotType.Minor)}})}loadJackpotAssets(){return new Promise(e=>{cc.assetManager.loadBundle("kiss918-jackpot-progression",(t,a)=>{if(t)return console.error(t);const o=`textures/${k.default.getInstance().getLanguageCode()}`,n=d.AsyncTask(e=>s(this,void 0,void 0,function*(){a.load(`${o}/Jackpot`,cc.SpriteFrame,(t,a)=>{this.jackpotBg.spriteFrame=a,e()})}));Promise.all([n]).then(()=>{e()})})})}};i([y(cc.Sprite)],b.prototype,"jackpotBg",void 0),i([y(cc.Node)],b.prototype,"jackpotCounter",void 0),i([y(cc.Label)],b.prototype,"labelMajor",void 0),i([y(cc.Label)],b.prototype,"labelRandom",void 0),i([y(cc.Label)],b.prototype,"labelMinor",void 0),b=i([C],b),a.default=b,cc._RF.pop()},{"../../../../../scripts/GlobalData":void 0,"../../../../../scripts/HelperTools":void 0,"../../../../../scripts/framework/gg":void 0,"../../../../../scripts/framework/lib/router/PanelComponent":void 0,"../../../../../scripts/manager/AudioManager":void 0,"../../../../../scripts/manager/BankManager":void 0,"../../../../../scripts/manager/CreditCoinConvertorManager":void 0,"../../../../../scripts/manager/GameSystemManager":void 0,"../jackpot-running-number-label/Kiss918JackpotRunningNumberLabel":"Kiss918JackpotRunningNumberLabel","./Kiss918JackpotEnum":"Kiss918JackpotEnum","./Kiss918JackpotProgressionModule":"Kiss918JackpotProgressionModule"}],Kiss918JackpotRunningNumberLabel:[function(e,t,a){"use strict";cc._RF.push(t,"407ffzro/pAz79ev+tlO5CN","Kiss918JackpotRunningNumberLabel");var o=this&&this.__decorate||function(e,t,a,o){var n,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,a,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(r=(i<3?n(r):i>3?n(t,a,r):n(t,a))||r);return i>3&&r&&Object.defineProperty(t,a,r),r},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});const i=n(e("../../../../../scripts/manager/GameSystemManager")),r=e("../../../../../scripts/TweenEasing"),{ccclass:s,property:c,requireComponent:l}=cc._decorator;var p;(function(e){e.ClosedOpen="ClosedOpen",e.ClosedEndless="ClosedEndless"})(p||(p={}));let u=class extends cc.Component{constructor(){super(...arguments),this.hasDecimal=!0,this.isRunning=!1,this.currentValue=0,this.startValue=0,this.finalValue=0,this.runDuration=0,this.targetLabel=null,this.tweenTrack=null,this.coinControlData=[],this.immediatelyToFinalValue=e=>{this.currentValue=e||this.finalValue,this.updateLabel(),this.onComplete()},this.onStart=()=>{this.isRunning=!0,this.startValue=this.currentValue,this.onStartRunningEventCallback&&this.onStartRunningEventCallback()},this.onComplete=()=>{this.isRunning=!1,this.tweenTrack&&(this.tweenTrack.stop(),this.tweenTrack=null),this.onCompleteRunningEventCallback&&this.onCompleteRunningEventCallback()}}get getIsRunning(){return this.isRunning}get getRunDuration(){return this.runDuration}onLoad(){this.setupProperty(),this.setupCoinConfig()}registerOnStartRunningEventCallback(e){this.onStartRunningEventCallback=e}registerOnCompleteRunningEventCallback(e){this.onCompleteRunningEventCallback=e}resetAllValue(){this.startValue=0,this.finalValue=0,this.currentValue=0,this.runDuration=0}updateCurrentValue(e,t){this.checkPreviousExecuteEvent(),this.finalValue=e,this.runDuration=t,this.executeRunLabel()}updateCurrentValueWithStartValue(e,t,a,o=!0){this.checkPreviousExecuteEvent(),this.finalValue=t,this.runDuration=a,this.executeRunLabel(e,o)}updateCurrentValueWithPresetCondition(e,t){if(this.checkPreviousExecuteEvent(),this.finalValue=e,e<=50)this.runDuration=.5,this.executeRunLabel();else{const a=e/t;this.runDuration=this.getConditionDuration(a),this.executeRunLabel()}}executeRunLabel(e,t=!0){let a={amount:this.startValue,callback:this.immediatelyToFinalValue};this.tweenTrack=cc.tween(a).call(this.onStart).to(this.runDuration,{amount:this.finalValue},{progress:(t,a,o,n)=>{this.currentValue=cc.misc.lerp(e||this.startValue,this.finalValue,n),this.updateLabel()},easing:t?r.TweenEasing.circOut:null}).call(this.onComplete).start()}checkPreviousExecuteEvent(){this.isRunning&&this.immediatelyToFinalValue()}updateLabel(){let e=this.hasDecimal?this.GetNumberDecimal(this.currentValue,2):this.GetNumberWithoutDecimal(this.currentValue);(this.targetLabel?this.targetLabel:this.node.getComponent(cc.Label)).string=e}getConditionDuration(e){if(this.coinControlData.length>0){for(const t of this.coinControlData)if(t.type===p.ClosedOpen&&e<=t.maximum)return t.duration;return this.coinControlData[this.coinControlData.length-1].duration}this.getDummyDuration(e)}GetNumberWithoutDecimal(e){return e.toFixed(0)}GetNumberDecimal(e,t){return e.toFixed(t)}setupProperty(){this.targetLabel=this.node.getComponent(cc.Label)}setupCoinConfig(){let e=i.default.getInstance().getConfig().cwc;if(e)for(const t of e)this.coinControlData.push({id:t.cwcid,name:t.cwcname,type:this.convertRangeStringToType(t.range),minimum:t.min,maximum:t.max,duration:t.second})}convertRangeStringToType(e){switch(e){case"ClosedOpen":return p.ClosedOpen;case"ClosedEndless":return p.ClosedEndless;default:return p.ClosedOpen}}getDummyDuration(e){return e<=15?3:e<=50?5:e<=100?8:e<=150?10:e<=200?12:e>200?15:void 0}};o([c()],u.prototype,"hasDecimal",void 0),u=o([s,l(cc.Label)],u),a.default=u,cc._RF.pop()},{"../../../../../scripts/TweenEasing":void 0,"../../../../../scripts/manager/GameSystemManager":void 0}],Kiss918JackpotServerModel:[function(e,t,a){"use strict";cc._RF.push(t,"2438eRSbKZKaI2PP78qt84W","Kiss918JackpotServerModel"),Object.defineProperty(a,"__esModule",{value:!0}),cc._RF.pop()},{}],Kiss918JackpotServer:[function(e,t,a){"use strict";cc._RF.push(t,"80d60rhA5FL/6zIkAYDXAiS","Kiss918JackpotServer");var o,n=this&&this.__decorate||function(e,t,a,o){var n,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,a,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(r=(i<3?n(r):i>3?n(t,a,r):n(t,a))||r);return i>3&&r&&Object.defineProperty(t,a,r),r},i=this&&this.__awaiter||function(e,t,a,o){return new(a||(a=Promise))(function(n,i){function r(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,s)}c((o=o.apply(e,t||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const r=e("../../../../../main-bundle/scripts/configs/PanelConfigs"),s=e("../../../../../scripts/framework/gg"),c=e("../../../../../scripts/GlobalData"),l=e("../../../../../scripts/HelperTools"),p=e("../../../../../scripts/manager/LocalizeManager"),{ccclass:u}=cc._decorator;let d=o=class{constructor(){this.jackpot={gameId:"700002",serviceURL:c.GlobalData.service.jackpotServiceURL,authServiceURL:c.GlobalData.service.jackpotAuthServiceURL,clientType:c.GlobalData.clientType,username:c.GlobalData.data.memberProfile.Username,language:l.GetURLParameter("lang")||"en-us",token:"",gameSessionId:-1}}static getInstance(){return o.instance||(o.instance=new o),o.instance}getJackpotLoginToken(){return i(this,void 0,void 0,function*(){return new Promise(e=>{if(!this.jackpot.authServiceURL)return void e({data:null,error:!0});const t={GameCode:this.jackpot.gameId,ClientType:this.jackpot.clientType,Username:this.jackpot.username,Language:this.jackpot.language},a=this.jackpot.authServiceURL+"login",o=performance.now();fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(t=>{if(t.ok)t.json().then(t=>{this.jackpot.token=t.token,e({data:t,error:""})});else{const a=performance.now()-o;this.showErrorPopUp({title:"Jackpot",timeTaken:a,err:t,msg:p.LocalizeText.error.pleaseLoginAgain,erroCode:l.StringFormat(p.LocalizeText.error.errorCode,t.status.toString(),"JackpotToken")}),e({data:null,error:t})}}).catch(t=>{const a=performance.now()-o;this.showErrorPopUp({title:"Jackpot",timeTaken:a,err:t,msg:p.LocalizeText.error.pleaseLoginAgain,erroCode:l.StringFormat(p.LocalizeText.error.httpErrorCode,t.status.toString(),"JackpotToken")}),e({data:null,error:{errcode:"promise_reject",errmsg:t}})})})})}doJackpotLogin(){return i(this,void 0,void 0,function*(){return new Promise(e=>{if(!this.jackpot.serviceURL)return void e({data:null,error:!0});const t={GameId:this.jackpot.gameId,Token:this.jackpot.token},a=this.jackpot.serviceURL+"Login",o=performance.now();fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(t=>{if(t.ok)t.json().then(t=>{t.JackpotInfo&&(this.jackpot.gameSessionId=t.JackpotInfo.GameSessionId),e({data:t,error:""})});else{const a=performance.now()-o;this.showErrorPopUp({title:"Jackpot",timeTaken:a,err:t,msg:p.LocalizeText.error.pleaseLoginAgain,erroCode:l.StringFormat(p.LocalizeText.error.errorCode,t.status.toString(),"JackpotLogin")}),e({data:null,error:t})}}).catch(t=>{const a=performance.now()-o;this.showErrorPopUp({title:"Jackpot",timeTaken:a,err:t,msg:p.LocalizeText.error.pleaseLoginAgain,erroCode:l.StringFormat(p.LocalizeText.error.httpErrorCode,t.status.toString(),"JackpotLogin")}),e({data:null,error:{errcode:"promise_reject",errmsg:t}})})})})}getCurrentJackpotInfo(){return i(this,void 0,void 0,function*(){return new Promise(e=>{if(!this.jackpot.serviceURL)return;const t={Token:this.jackpot.token},a=this.jackpot.serviceURL+"Current",o=performance.now();fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(t=>{if(t.ok)t.json().then(t=>{t.JackpotInfo&&(this.jackpot.gameSessionId=t.JackpotInfo.GameSessionId),e({data:t,error:""})});else{const a=performance.now()-o;this.showErrorPopUp({title:"Jackpot",timeTaken:a,err:t,msg:p.LocalizeText.error.pleaseLoginAgain,erroCode:l.StringFormat(p.LocalizeText.error.errorCode,t.status.toString(),"JackpotInfo")}),e({data:null,error:t})}}).catch(t=>{const a=performance.now()-o;this.showErrorPopUp({title:"Jackpot",timeTaken:a,err:t,msg:p.LocalizeText.error.pleaseLoginAgain,erroCode:l.StringFormat(p.LocalizeText.error.httpErrorCode,t.status.toString(),"JackpotInfo")}),e({data:null,error:{errcode:"promise_reject",errmsg:t}})})})})}claimJackpot(){return i(this,void 0,void 0,function*(){return new Promise(e=>{if(!this.jackpot.serviceURL)return;const t={Token:this.jackpot.token,GameSessionId:this.jackpot.gameSessionId},a=this.jackpot.serviceURL+"Claim",o=performance.now();fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(t=>{if(t.ok)t.json().then(t=>{this.jackpot.gameSessionId=-1,e({data:t,error:""})});else{const a=performance.now()-o;this.showErrorPopUp({title:"Jackpot",timeTaken:a,err:t,msg:p.LocalizeText.error.pleaseLoginAgain,erroCode:l.StringFormat(p.LocalizeText.error.errorCode,t.status.toString(),"JackpotClaim")}),e({data:null,error:t})}}).catch(t=>{const a=performance.now()-o;this.showErrorPopUp({title:"Jackpot",timeTaken:a,err:t,msg:p.LocalizeText.error.pleaseLoginAgain,erroCode:l.StringFormat(p.LocalizeText.error.httpErrorCode,t.status.toString(),"JackpotClaim")}),e({data:null,error:{errcode:"promise_reject",errmsg:t}})})})})}showErrorPopUp(e){console.error(e.err),console.error(e.msg,e.erroCode);const t="EID-"+l.RandomUUID().split("-")[0],a={eventId:t,title:e.title,slotGameCode:"JackpotModule",apiTimeTaken:e.timeTaken.toFixed(2)+" ms",gameInfo:c.GlobalData.gameInfo,eventTime:dayjs().format("YYYY-MM-DD HH:mm:ss").toLocaleLowerCase(),errorMsg:e.err};switch(s.gg.eventManager.emit("GameReporter.OnErrorReport",e.title,JSON.stringify(a)),e.title){case"Jackpot":break;default:s.gg.panelRouter.show({panel:r.PanelConfigs.errorToastPanel,data:{message:e.msg,errorCode:t+" "+e.erroCode}})}}};d=o=n([u],d),a.default=d,cc._RF.pop()},{"../../../../../main-bundle/scripts/configs/PanelConfigs":void 0,"../../../../../scripts/GlobalData":void 0,"../../../../../scripts/HelperTools":void 0,"../../../../../scripts/framework/gg":void 0,"../../../../../scripts/manager/LocalizeManager":void 0}]},{},["Kiss918JackpotRunningNumberLabel","Kiss918AngpaoPrefab","Kiss918JackpotEnum","Kiss918JackpotProgressionModule","Kiss918JackpotProgressionPrefab","Kiss918JackpotServer","Kiss918JackpotServerModel"]);